# Настройка платежного виджета Альфа-Банка

## Обзор

Этот проект включает интеграцию с платежным виджетом Альфа-Банка для приема платежей на сайте. Виджет позволяет клиентам оплачивать товары и услуги банковскими картами без необходимости покидать ваш сайт.

## Функциональность

- ✅ Настройка токена магазина
- ✅ Тестовый и продакшн режимы
- ✅ Настройка языка интерфейса
- ✅ Кастомизация текста кнопки
- ✅ Настройка URL для успешной/неуспешной оплаты
- ✅ Тестирование виджета с различными данными
- ✅ Генерация кода для вставки на сайт
- ✅ Автоматическое сохранение настроек

## Пошаговая настройка

### 1. Получение токена

1. Зайдите в [личный кабинет Альфа-Банка](https://alfabank.ru/sme/payservice/internet-acquiring/)
2. Перейдите в раздел "Настройки" → "Платёжный токен"
3. Нажмите "Сгенерировать" для получения токена
4. Скопируйте полученный токен

### 2. Настройка в админ-панели

1. Откройте раздел "Платежная система" в админ-панели
2. Нажмите кнопку "Настройки"
3. Введите полученный токен в поле "Токен магазина"
4. Выберите режим работы:
   - **Тестовый режим** - для тестирования
   - **Продакшн режим** - для реальных платежей
5. Настройте дополнительные параметры:
   - Язык интерфейса (русский/английский)
   - Текст кнопки оплаты
   - URL для успешной оплаты
   - URL для неуспешной оплаты
6. Сохраните настройки

### 3. Тестирование виджета

1. Нажмите кнопку "Тестировать виджет"
2. Заполните тестовые данные заказа:
   - Сумма платежа
   - Номер заказа
   - Имя клиента
   - Email клиента
   - Описание заказа
3. Нажмите кнопку "Оплатить картой" в виджете
4. Проверьте работу в тестовом режиме

### 4. Интеграция на сайт

1. Скопируйте сгенерированный код из раздела "Код для вставки на сайт"
2. Вставьте код на страницу, где должна отображаться кнопка оплаты
3. Убедитесь, что на странице есть элементы с классами:
   - `.amount` - сумма заказа
   - `.orderNumber` - номер заказа
   - `.clientInfo` - информация о клиенте
   - `.clientEmail` - email клиента
   - `.orderDescription` - описание заказа

## Структура кода

### Основные компоненты

- `PaymentSystem.tsx` - основной компонент платежной системы
- `AlfaBankWidget.tsx` - компонент виджета Альфа-Банка
- `PaymentSystem.css` - стили для платежной системы
- `AlfaBankWidget.css` - стили для виджета

### Конфигурация

Настройки виджета сохраняются в localStorage и включают:

```typescript
interface AlfaBankConfig {
  token: string; // Токен магазина
  gateway: "test" | "pay"; // Режим работы
  testMode: boolean; // Тестовый режим
  returnUrl: string; // URL успешной оплаты
  failUrl: string; // URL неуспешной оплаты
  language: "ru" | "en"; // Язык интерфейса
  buttonText: string; // Текст кнопки
}
```

## Параметры виджета

### Обязательные параметры

- `data-token` - токен магазина
- `data-gateway` - режим работы ("test" или "pay")
- `data-amount-selector` - селектор элемента с суммой заказа

### Дополнительные параметры

- `data-language` - язык интерфейса ("ru" или "en")
- `data-button-text` - текст кнопки оплаты
- `data-return-url` - URL для успешной оплаты
- `data-fail-url` - URL для неуспешной оплаты
- `data-order-number-selector` - селектор номера заказа
- `data-client-info-selector` - селектор информации о клиенте
- `data-email-selector` - селектор email клиента
- `data-description-selector` - селектор описания заказа

## Тестовые данные

Для тестирования в тестовом режиме используйте:

- **Номер карты:** 4111 1111 1111 1111
- **Срок действия:** любой будущий месяц/год
- **CVV:** любые 3 цифры
- **3D Secure:** любой код

## Безопасность

- Токен не является секретным и может быть размещен в клиентском коде
- Все карточные данные обрабатываются на стороне Альфа-Банка
- Виджет соответствует стандарту PCI DSS
- Рекомендуется использовать HTTPS для продакшн среды

## Поддержка

- [Документация Альфа-Банка](https://alfabank.ru/sme/payservice/internet-acquiring/docs/connection-options/widget/)
- Email поддержки: acquiring@alfabank.ru

## Пример использования

```html
<!-- Подключение скрипта -->
<script
  id="alfa-payment-script"
  type="text/javascript"
  src="https://testpay.alfabank.ru/assets/alfa-payment.js"
></script>

<!-- Данные заказа -->
<input type="hidden" class="amount" value="1000" />
<input type="hidden" class="orderNumber" value="ORDER-001" />
<input type="hidden" class="clientInfo" value="Иван Иванов" />
<input type="hidden" class="clientEmail" value="ivan@example.com" />
<input type="hidden" class="orderDescription" value="Консультация врача" />

<!-- Виджет -->
<div
  id="alfa-payment-button"
  data-token="your_merchant_token"
  data-gateway="test"
  data-language="ru"
  data-button-text="Оплатить картой"
  data-return-url="https://yoursite.com/success"
  data-fail-url="https://yoursite.com/fail"
  data-amount-selector=".amount"
  data-order-number-selector=".orderNumber"
  data-client-info-selector=".clientInfo"
  data-email-selector=".clientEmail"
  data-description-selector=".orderDescription"
></div>
```
