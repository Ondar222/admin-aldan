# –í–∏–¥–∂–µ—Ç –ø–æ–∫—É–ø–∫–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

–≠—Ç–æ—Ç –≤–∏–¥–∂–µ—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Ñ–æ—Ä–º—É –ø–æ–∫—É–ø–∫–∏ –ø–æ–¥–∞—Ä–æ—á–Ω—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –Ω–∞ –ª—é–±—ã–µ –≤–µ–±-—Å–∞–π—Ç—ã.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –ó–∞–ø—É—Å–∫ –±—ç–∫–µ–Ω–¥–∞
cd backend
npm start

# –ó–∞–ø—É—Å–∫ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (–≤ –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
npm run dev
```

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `test-widget.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã –≤–∏–¥–∂–µ—Ç–∞.

## –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞

### –°–ø–æ—Å–æ–± 1: Iframe (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)

```html
<iframe
  src="http://localhost:5173/widget.html?config=CONFIG&apiUrl=API_URL&token=TOKEN"
  width="400"
  height="600"
  frameborder="0"
  style="border: none; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);"
></iframe>
```

### –°–ø–æ—Å–æ–± 2: JavaScript

```html
<div id="certificate-widget"></div>
<script>
  const script = document.createElement("script");
  script.src = "http://localhost:5173/widget/certificate.js";
  script.onload = function () {
    window.CertificateWidget.init({
      container: "#certificate-widget",
      config: {
        title: "–ü–æ–¥–∞—Ä–æ—á–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç",
        subtitle: "–ö–ª–∏–Ω–∏–∫–∞ –ê–ª–¥–∞–Ω",
        logo: "‚ù§Ô∏è",
        primaryColor: "#2563eb",
        backgroundColor: "#ffffff",
      },
      apiUrl: "http://localhost:3001/api",
      token: "your-token-here",
      onSuccess: function (certificateData) {
        console.log("–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–æ–∑–¥–∞–Ω:", certificateData);
      },
      onError: function (error) {
        console.error("–û—à–∏–±–∫–∞:", error);
      },
    });
  };
  document.head.appendChild(script);
</script>
```

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### config (JSON –æ–±—ä–µ–∫—Ç)

```json
{
  "title": "–ü–æ–¥–∞—Ä–æ—á–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç",
  "subtitle": "–ö–ª–∏–Ω–∏–∫–∞ –ê–ª–¥–∞–Ω",
  "logo": "‚ù§Ô∏è",
  "primaryColor": "#2563eb",
  "backgroundColor": "#ffffff"
}
```

- **title** - –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤–∏–¥–∂–µ—Ç–∞
- **subtitle** - –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫
- **logo** - –ª–æ–≥–æ—Ç–∏–ø (—ç–º–æ–¥–∑–∏ –∏–ª–∏ —Ç–µ–∫—Å—Ç)
- **primaryColor** - –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç –∫–Ω–æ–ø–æ–∫ –∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- **backgroundColor** - —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ –≤–∏–¥–∂–µ—Ç–∞

### apiUrl

URL –≤–∞—à–µ–≥–æ API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `http://localhost:3001/api`

### token (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–¢–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤.

## API Endpoints

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

```
POST /api/certificates
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**

```json
{
  "balance": 1000,
  "client_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
  "client_email": "ivan@example.com",
  "client_phone": "+7 999 123-45-67"
}
```

**–û—Ç–≤–µ—Ç:**

```json
{
  "success": true,
  "certificate": {
    "id": "123456",
    "balance": 1000,
    "status": "paid",
    "client_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
    "client_email": "ivan@example.com",
    "client_phone": "+7 999 123-45-67",
    "created_at": "2024-01-01T00:00:00.000Z"
  }
}
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π

### PostMessage API

–í–∏–¥–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º—É –æ–∫–Ω—É:

```javascript
window.addEventListener("message", function (event) {
  if (event.data.type === "CERTIFICATE_CREATED") {
    console.log("–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–æ–∑–¥–∞–Ω:", event.data.data);
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è
  } else if (event.data.type === "CERTIFICATE_ERROR") {
    console.error("–û—à–∏–±–∫–∞:", event.data.error);
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
  }
});
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ URL

–ó–∞–º–µ–Ω–∏—Ç–µ `http://localhost:5173` –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω:

```html
<iframe
  src="https://your-domain.com/widget.html?config=CONFIG&apiUrl=API_URL"
  width="400"
  height="600"
  frameborder="0"
></iframe>
```

### 2. CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à API —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Å –¥–æ–º–µ–Ω–∞, –≥–¥–µ —Ä–∞–∑–º–µ—â–µ–Ω –≤–∏–¥–∂–µ—Ç:

```javascript
// –í backend/server.js
app.use(
  cors({
    origin: ["https://your-domain.com", "https://client-domain.com"],
    credentials: true,
  })
);
```

### 3. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ API –ø–æ –¥–æ–º–µ–Ω–∞–º

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤—ã–π –≤–∏–¥–∂–µ—Ç

```html
<iframe
  src="https://your-domain.com/widget.html"
  width="400"
  height="600"
  frameborder="0"
></iframe>
```

### –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤–∏–¥–∂–µ—Ç

```html
<iframe
  src="https://your-domain.com/widget.html?config=%7B%22title%22%3A%22–ü–æ–¥–∞—Ä–æ—á–Ω—ã–π%20—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç%22%2C%22subtitle%22%3A%22–ù–∞—à–∞%20–∫–ª–∏–Ω–∏–∫–∞%22%2C%22logo%22%3A%22üè•%22%2C%22primaryColor%22%3A%22%23e11d48%22%7D&apiUrl=https%3A//api.your-domain.com"
  width="400"
  height="600"
  frameborder="0"
></iframe>
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –í–∏–¥–∂–µ—Ç –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏

### API –∑–∞–ø—Ä–æ—Å—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API –¥–æ—Å—Ç—É–ø–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –ü—Ä–æ–±–ª–µ–º—ã —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä—ã iframe
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ CSS –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º —Å–∏—Å—Ç–µ–º—ã.
